---
title: "Assignment 5"
author: "Jordan Faires"
date: "11/28/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


# Introduction

# Data and Methods

```{r}

# Load packages

library(tidyverse)
library(car)
library(janitor)
library(kableExtra)
library(ggbeeswarm)

# Read in data, filter for Pacific giant salamanders (species code “DITE”)

mack_vertebrates <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names()

mack_salamander <- mack_vertebrates %>% 
  filter(species == "DITE")

```

```{r}

# Results A - Visually comparing annual salamander counts in old growth (OG) and clear cut (CC) sections of Mack Creek

# Summarize by year, find counts 

salamander_annual <- mack_salamander %>% 
  count(year, section) %>% 
  group_by(section)

# Graph trends over time

ggplot(salamander_annual, aes(x=year, y=n, group=section, color=section)) +
  geom_line() +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        panel.background = element_rect(fill = "gray99", size = .1)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "",
       y = "Annual Count",
       title = "Annual Count of Pacific Giant Salamanders, 1993-2017") +
    scale_color_discrete(breaks=c("CC", 
                                  "OG"),
                       labels=c("Clear Cut", 
                                "Old Growth"),
                       name = "Stream Section") +
  theme(legend.position = c(0.18, 0.72))



```
**Figure 1** Annual counts of Pacific giant salamanders observed in the old growth and clear cut section of Mack Creek, 1993 - 2017. While salamander counts in old growth sections have generally been slightly greater over time, trends in populations in both sections appear to be closely related. Salamander counts in the clear cut section were greater than counts in the old growth section beginning in 2015. 

**Table 1** Counts and proportions of Pacific giant salamanders observed in 2017. Counts are categorized by channel classification (pool, cascade or side channel) and stream section (clear cut or old growth).
```{r}

# Results B - Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek.

# Remove isolated pools, filter for 2017 observations, reclassify channel types as pool, cascade, side-channel. SC/side channel = side_channel, P/pool = pool, C/cascade,I/riffle,C/cascade,S/small step = cascade.

salamander_channel_type <- mack_salamander %>%
  filter(year == "2017") %>% 
  filter(!unittype == "IP") %>% 
  mutate(channel_type = ifelse(unittype == "SC", "side_channel", ifelse(unittype == "P", "pool", ifelse(unittype %in% c("C", "I", "R", "S"), "cascade", ""))))

channel_type_counts <- salamander_channel_type %>% 
  count(section, channel_type)

channel_count_table <- channel_type_counts %>% 
    pivot_wider(names_from = section, values_from = n)

channel_count_props <- channel_count_table %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_ns(position = "front")

kable(channel_count_props,
      col.names = c("Channel Type", 
                     "Clear Cut", 
                     "Old Growth")) %>% 
  kable_styling()

channel_count_props
```
```{r}
# Results C: Using the 2017 counts found in Results B above, answer: is there a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two sections (old growth and clear cut)? 


chi_counts <- channel_count_table %>% 
  select(-channel_type)

chi_test <- chisq.test(chi_counts)
chi_test

```

The location of Pacific giant salamanders in the channel varies based on the section of stream. Pacific giant salamanders are found slightly more in cascades in clear cut forests ()

However, there is a not significant effect of the section of stream on where Pacific giant salamanders are located (pool, cascade or side chnnel) ($\chi$^2^(`r chi_test$parameter`) = `r round(chi_test$statistic,2)`, *p* = `r round(chi_test$p.value, 2)`). 




$\chi^2$
