---
title: "Assignment 5"
author: "Jordan Faires"
date: "11/28/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


# Introduction

# Data and Methods

```{r}

# Load packages

library(tidyverse)
library(car)
library(janitor)
library(kableExtra)
library(ggbeeswarm)

# Read in data, filter for Pacific giant salamanders (species code “DITE”)

mack_vertebrates <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names()

mack_salamander <- mack_vertebrates %>% 
  filter(species == "DITE")

```

```{r}

# Results A - Visually comparing annual salamander counts in old growth (OG) and clear cut (CC) sections of Mack Creek

# Summarize by year, find counts 

salamander_annual <- mack_salamander %>% 
  count(year, section) %>% 
  group_by(section)

# Graph trends over time

ggplot(salamander_annual, aes(x=year, y=n, group=section, color=section)) +
  geom_line() +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        panel.background = element_rect(fill = "gray99", size = .1)) +
  scale_y_continuous(expand = c(0,10)) +
  labs(x = "",
       y = "Annual Count",
       title = "Annual Count of Pacific Giant Salamanders, 1993-2017") +
    scale_color_discrete(breaks=c("CC", 
                                  "OG"),
                       labels=c("Clear Cut", 
                                "Old Growth"),
                       name = "Stream Section") +
  theme(legend.position = c(0.18, 0.72))



```
**Figure 1** Annual counts of Pacific giant salamanders observed in the old growth and clear cut section of Mack Creek, 1993 - 2017. While salamander counts in old growth sections have generally been slightly greater over time, trends in populations in both sections appear to be closely related. Salamander counts in the clear cut section were greater than counts in the old growth section beginning in 2015. 

**Table 1** Counts and proportions of Pacific giant salamanders observed in 2017. Counts are categorized by channel classification (pool, cascade or side channel) and stream section (clear cut or old growth).
```{r}

# Results B - Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek.

# Remove isolated pools, filter for 2017 observations, reclassify channel types as pool, cascade, side-channel. SC/side channel = side_channel, P/pool = pool, C/cascade,I/riffle,C/cascade,S/small step = cascade.

salamander_channel_type <- mack_salamander %>%
  filter(year == "2017") %>% 
  filter(!unittype == "IP") %>% 
  mutate(channel_type = ifelse(unittype == "SC", "side_channel", ifelse(unittype == "P", "pool", ifelse(unittype %in% c("C", "I", "R", "S"), "cascade", ""))))

channel_type_counts <- salamander_channel_type %>% 
  count(section, channel_type)

channel_count_table <- channel_type_counts %>% 
    pivot_wider(names_from = section, values_from = n)

channel_count_props <- channel_count_table %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_ns(position = "front")

kable(channel_count_props,
      col.names = c("Channel Type", 
                     "Clear Cut", 
                     "Old Growth")) %>% 
  kable_styling()

channel_count_props
```
```{r}
# Results C: Using the 2017 counts found in Results B above, answer: is there a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two sections (old growth and clear cut)? 

chi_counts <- channel_count_table %>% 
  select(-channel_type)

chi_test <- chisq.test(chi_counts)
chi_test

```

In 2017, the location of Pacific giant salamanders in the channel varied slightly based on the section of stream. Pacific giant salamanders are found slightly more in cascades in clear cut forests (n = 247, 55.1% ) than in old growth forests (n = 201, 44.9%), slightly less in pools in clear cut forests (n = 31, 40.8%) than in clear cut forests (n = 45, 59.2%), and more in side channels in clear cut forests (n = 90, 54.9%) than in old growth forests (n = 47, 45.1%). However, there is a not significant effect of the section of stream on where Pacific giant salamanders are located (pool, cascade or side chnnel) by a Chi-square test ($\chi$^2^(`r chi_test$parameter`) = `r round(chi_test$statistic,2)`, *p* = `r round(chi_test$p.value, 2)`). 


```{r}

# Results D. Compare weights of Pacific giant salamanders in clear cut and old growth forest sections of the creek in 2017. 


# Look at data 

ggplot(data = salamander_channel_type, aes(x = weight)) +
  geom_histogram()

  facet_wrap(~section)

# Look at a QQ plot to check for normality

ggplot(data = penguin_f, aes(sample = flipper_length_mm)) +
  geom_qq() +
  facet_wrap(~species)



salamander_2017_og <- salamander_channel_type %>% 
  filter(section == "OG")

salamander_2017_cc <- salamander_channel_type %>% 
  filter(section == "CC")

weight_ttest <- t.test(salamander_2017_og$weight, salamander_2017_cc$weight)
weight_ttest

```

However, mean salamander weight observed in old growth sections (`r round(weight_ttest$estimate[1],2)`) and clear cut sections (`r round(weight_ttest$estimate[2],2)`) is not significantly different (t(`r round(weight_ttest$parameter,2)`) = `r round(weight_ttest$statistic,2)`, *p* = `r round (weight_ttest$p.value,2)`).

```{r}

# Results E. Compare weights of Pacific giant salamanders in pools, cascades and side-channels of Mack Creek in 2017. 

# First, visually compare Pacific giant salamander weights between the three channel classifications.

# Make summary table 
penguin_f_summary <- penguin_f %>% 
  group_by(species) %>% 
  summarize(
    mean_flipper_length = mean(flipper_length_mm),
    sd_flipper_length = sd(flipper_length_mm),
    sample_size = n(),
    se_flipper_length = sd(flipper_length_mm) / sqrt(n()),
    var_flipper_length = var(flipper_length_mm)

salamander_channel_type <- 
  
  
  ggplot() +
  geom_beeswarm(data = penguin_f,
                aes(x = species,
                    y = flipper_length_mm),
                size = 1,
                alpha = .6,
                color = "gray60") +
  scale_x_discrete(labels = c("Adelie", "Chinstrap", "Gentoo")) +
  geom_point(data = penguin_f_summary, aes(x = species, y = mean_flipper_length),
             color = "red",
             size = 2) +
  geom_errorbar(data = penguin_f_summary,
                aes(x = species,
                    ymin = mean_flipper_length - sd_flipper_length,
                    ymax = mean_flipper_length + sd_flipper_length),
                width = .1,
                color = "red") +
  theme_bw()
  
  

```

